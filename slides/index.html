<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <title>Foreign Data Wrapper sous PostgreSQL</title>

        <link rel="stylesheet" href="css/reveal.css">
        <link rel="stylesheet" href="css/theme/white.css">

        <link rel="stylesheet" href="css/custom.css">

        <!-- Theme used for syntax highlighting of code -->
        <link rel="stylesheet" href="lib/css/idea.css">

        <!-- Printing and PDF exports -->
        <script>
            var link = document.createElement( 'link' );
            link.rel = 'stylesheet';
            link.type = 'text/css';
            link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
            document.getElementsByTagName( 'head' )[0].appendChild( link );
        </script>
    </head>
    <body>
        <div class="reveal">
            <div class="slides">


                <section id="title">
                    <h1>Foreign Data Wrapper</h1>
                    <h2>ou un réseau social pour vos données</h2>
                    <h2>sous PostgreSQL</h2>
                </section>

                <section id="qui-suis-je">
                    <h1>Qui suis-je ?</h1>

                    <div class="flex-row">
                        <div>
                            <img id="avatar" class="clean-image" src="./assets/img/my-disk-world.png" alt="avatar" />
                        </div>
                        <div class="flex-element-centered">
                            <div class="name">Florian FERRIERE</div>
                            <div class="twitter">
                                <a href="https://twitter.com/FerriereFlorian">@FerriereFlorian</a>
                            </div>
                        </div>
                    </div>

                    <div>
                        <div>
                            Développeur chez Norsys
                        </div>
                        <div>
                            <img id="logo-norsys" src="./assets/img/norsys.png" alt="norsys" />
                        </div>
                    </div>
                </section>

                <section id="pg_en_3_mots">

                    <section id="postgresql">
                        <div>
                            <div>
                                <img id="logo-postgresql" class="clean-image" src="./assets/img/postgresql.png" alt="postgresql" />
                            </div>

                            <h1>
                                PostgreSQL
                            </h1>

                            <aside class="notes">
                                Avant de parler des Foreign Data Wrapper,
                                je vais rapidement vous parler des PostgreSQL.
                            </aside>
                        </div>
                    </section>

                    <section id="fonctionnalites_generales">
                        <h1>Fonctionnalités générales</h1>

                        <ul>
                            <li class="fragment">SGBDRO</li>
                            <li class="fragment">Accessible : JDBC, pgsql, ...</li>
                            <li class="fragment">
                                SQL :
                                <ul>
                                    <li class="fragment">Triggers</li>
                                    <li class="fragment">Common Table Expressions</li>
                                    <li class="fragment">Procedural Language (PL/pgSQL, PL/JAVA, PL/PHP, ...)</li>
                                    <li class="fragment">Vues et Vues matérialisées</li>
                                    <li class="fragment">...</li>
                                </ul>
                            </li>
                            <li class="fragment">JSON</li>
                            <li class="fragment">PostGIS</li>
                            <li class="fragment">...</li>
                            <li class="fragment">Foreign Data Wrapper</li>
                        </ul>

                        <aside class="notes">
                            Fonctionnalités générales :
                            <ul>
                                <li>Server de Gestion de Base de Données Relationnel Objet</li>
                                <li>
                                    Accessible avec plein de language de programation :
                                        - JDBC pour JAVA
                                        - lib pgsql pour PHP
                                </li>
                                <li>
                                    SQL :
                                     - PL : PL/pgSQL, PL/Tcl, PL/Perl et PL/Python de base
                                     - <a href="https://www.postgresql.org/docs/9.6/static/external-pl.html">Extension pour PL</a> : PL/JAVA, PL/PHP, PL/Py, PL/R, PL/Ruby
                                </li>
                                <li>
                                    PostGIS : gestion des objets Spatiaux et Géographique.
                                    Utilisé par OpenStreetMap.
                                </li>
                                <li>...</li>
                                <li>Foreign Data Wrapper</li>
                            </ul>
                        </aside>
                    </section>

                </section>

                <section id="foreign_data_wrapper">

                    <section id="fdw_explication">
                        <h1>Foreign Data Wrapper</h1>
                        <h2>Qu'est-ce que c'est ?</h2>

                        <p class="fragment">Norme SQL/MED (Management of External Data)</p>
                        <p class="fragment">Créée en 2003</p>
                        <p id="creation_wrapper" class="fragment">
                            Création de wrapper :
                            <ul>
                                <li class="fragment">Nativement en C</li>
                                <li class="fragment">En python avec "Multicorn"</li>
                                <li class="fragment">En ruby avec "Holycorn"</li>
                            </ul>
                        </p>

                        <aside class="notes">
                            Le Foreign Data Wrapper est une implémentation de la norme SQL/MED
                            (Management of External Data), créée en 2003.
                            Comme son nom l'indique, cette norme permet la gestion des données externes,
                            depuis un autre SGBD ou des sources diverses.
                            Il est possible de créer son propre wrapper en C en utilisant
                            les fonctions prévues à cet effet.
                            Des extensions comme "Multicorn" en python ou "Holycorn" en ruby
                            apporte un lot de wrapper et permet de la créer des wrappers plus facilement.
                            Grace à ça, il existe, à ce jour, un nombre important de wrapper.
                        </aside>
                    </section>

                    <section id="wrappers_list">
                        <h1>Quelques Wrappers</h1>

                        <div id="SGDB_fdw">
                            <p class="fragment">PostgreSQL</p>
                            <p class="fragment">SGBD SQL courants : MySQL, Oracle, SQL Server, SQLite, ...</p>
                            <p class="fragment">Connecteurs SQL génériques : ODBC, JDBC</p>
                            <p class="fragment">NoSQL : MongoDB, Cassandra, Redis, ...</p>
                        </div>
                        <div id="extra_fdw">
                            <p class="fragment">CSV, XML, LDAP</p>
                            <p class="fragment">Git, Logs, WWW, IMAP</p>
                            <p class="fragment">Processus, Twitter, Docker, RabbitMQ, ...</p>
                        </div>

                        <aside class="notes">
                            Voici une liste non exhaustive :
                            <ul>
                                <li>Forcément nous avons la possibilité de connecté un serveur PostgreSQL avec un autre.</li>
                                <li>Mais également avec d'autres SGBD.</li>
                                <li>Soit avec les connecteurs natifs</li>
                                <li>Soit avec des connecteurs génériques</li>
                                <li>Il est aussi possible de dialoguer avec des serveurs NoSQL.</li>
                                <li>Il y a aussi des connecteurs vers des fichiers CSV, XML ou un serveur LDAP</li>
                                <li>Ou encore des systèmes plus atypiques comme Git, les logs systèmes, des services web ou des mails via le protocol IMAP</li>
                                <li>Et pourquoi pas la liste des processus du système, votre timeline twitter</li>
                                <li>Et même une connexion avec le serveur docker pour lister les containeurs ou les images</li>
                                <li>Et tant d'autre</li>
                            </ul>
                        </aside>
                    </section>

                </section>

                <section id="git_fdw">
                    <h1>Git FDW</h1>

                    <section>
                    </section>

                    <section id="git_fdw_presentation">
                        <h2>Déclaration du serveur</h2>
                        <pre><code class="hlsql">
    CREATE EXTENSION multicorn;

    CREATE SERVER git_server
        FOREIGN DATA WRAPPER multicorn
        OPTIONS (
            wrapper 'multicorn.gitfdw.GitFdw'
        );
                        </code></pre>

                        <aside class="notes">
                            Nous allons voir rapidement comment utiliser le FDW pour git.
                            Il y a deux extensions pour GIT une en C et un composant compris dans multicorn.

                            J'aurai préféré utiliser l'extension en C
                            mais la compilation n'a pas fonctionnée.

                            Je me suis donc rabattu sur l'extension multicorn.
                            Sont installation est décrite dans le <a href="../../../git_fdw/README.md" target="_blank">README</a> que j'ai utilisé pour tester.

                            Une fois l'installation faite, la configuration est très simple.
                            Comme on l'a déjà vu tout à l'heure : on crée l'extension.
                            Puis le serveur.
                        </aside>
                    </section>

                    <section>
                        <h2>Déclaration de la table</h2>
                        <pre><code class="hlsql">
    CREATE FOREIGN TABLE git_atoum (
        author_name VARCHAR(128),
        author_email VARCHAR(128),
        message TEXT,
        hash VARCHAR(128),
        date TIMESTAMP
    )
    SERVER git_server
    OPTIONS (
        path '/opt/atoum'
    );
                        </code></pre>

                        <aside class="notes">
                            Ensuite il suffit de créer la table distante avec les bonnes options.
                        </aside>
                    </section>

                    <section id="git_fdw_select">
                        <h2>SELECT</h2>
                        <pre><code class="hlsql">
    SELECT to_char(date, 'YYYY-TQ') AS quarter,
            COUNT(*) as nb_commit
    FROM git_atoum
    GROUP BY to_char(date, 'YYYY-TQ')
    ORDER BY quarter ASC;
                        </code></pre>

                        <aside class="notes">
                            Voici un exemple de requête SQL que nous pouvons faire.
                        </aside>
                    </section>

                    <section id="git_fdw_result">
                        <h2>Résultat</h2>
                        <pre> quarter | nb_commit
---------+-----------
 2010-T2 |        25
 2010-T3 |        64
 2010-T4 |       108
 2011-T1 |       144
 2011-T2 |       199
 2011-T3 |       230
 2011-T4 |       174
 2012-T1 |        89
 2012-T2 |       137
 2012-T3 |       150
 2012-T4 |       184
 2013-T1 |       215
 2013-T2 |       234
 2013-T3 |       119
 2013-T4 |       217</pre>
                        <pre> quarter | nb_commit
---------+-----------
 2014-T1 |       108
 2014-T2 |        29
 2014-T3 |        26
 2014-T4 |       110
 2015-T1 |        58
 2015-T2 |        46
 2015-T3 |        65
 2015-T4 |        75
 2016-T1 |        85
 2016-T2 |        27
 2016-T3 |        43
 2016-T4 |         7
 (27 rows)

Time: 63.959 ms</pre>

                        <aside class="notes">
                            Le résultat est rapide et simple à optenir.

                            Ce résultat serai bien plus compliqué à obtenir en ligne de commande, mais sûrement pas impossible.
                        </aside>
                    </section>

                    <section id="git_fdw_select_in_json">
                        <h2>Graph (requête)</h2>
                        <pre><code class="hlsql">
    SELECT to_json(t)
    FROM (
        SELECT  array_agg(data.quarter) AS labels,
                array_agg(data.nb_commit) AS data
        FROM (
            SELECT to_char(date, 'YYYY-TQ') AS quarter,
                    COUNT(*) as nb_commit
            FROM git_atoum
            GROUP BY to_char(date, 'YYYY-TQ')
            ORDER BY quarter ASC
        ) AS data
    ) AS t;
                        </code></pre>

                        <aside class="notes">
                            En associant la requête précédente avec le module JSON de PostgreSQL,
                            nous pouvons obtenir un résultat en JSON utilisable directement (ou presque).
                        </aside>
                    </section>

                    <section id="git_fdw_chart">
                        <h2>Graph (resultat)</h2>
                        <iframe src="./git-fdw.chart.html" style="width: 100%; min-height: 450px;" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe>

                        <aside class="notes">
                            Voici comment on peut utiliser le résultat en JSON assez facilement pour avoir un graph.
                        </aside>
                    </section>
                </section>

                <section id="documentation">
                    <h1>Documentation</h1>

                    <p>
                        <a href="https://wiki.postgresql.org/wiki/Foreign_data_wrappers">Page des Foreign Data Wrappers</a>
                    </p>

                    <p>
                        <a href="https://www.postgresql.org/docs/">Documentation de PG</a>
                    </p>

                    <p>
                        <a href="https://www.youtube.com/watch?v=iOwnUPSY0KI">Postgresql : la nouvelle base orientée document par Yan Bonnel (Vidéos)</a>
                    </p>

                    <p>
                        <a href="https://github.com/fferriere/presentation_pg_fdw">Projet Github</a>
                    </p>
                </section>

                <section id="merci">
                    <h1>Merci</h1>

                    <h2>Des questions ?</h2>
                </section>

            </div>
        </div>

        <script src="lib/js/head.min.js"></script>
        <script src="js/reveal.js"></script>

        <script>
            // More info https://github.com/hakimel/reveal.js#configuration
            Reveal.initialize({
                history: true,
                slideNumber: 'c/t',
                center: true,
                mouseWheel: true,

                // More info https://github.com/hakimel/reveal.js#dependencies
                dependencies: [
                    { src: 'plugin/markdown/marked.js' },
                    { src: 'plugin/markdown/markdown.js' },
                    { src: 'plugin/notes/notes.js', async: true },
                    { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
                ]
            });
        </script>
    </body>
</html>
